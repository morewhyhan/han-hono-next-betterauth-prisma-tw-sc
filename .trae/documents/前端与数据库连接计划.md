# 前端与数据库连接计划

## 1. 技术栈概述

* **前端框架**: Next.js 15 + React 19

* **样式**: Tailwind CSS + Shadcn UI

* **API**: Hono.js

* **数据库**: SQLite + Prisma ORM

* **数据管理**: TanStack React Query

* **认证**: Better Auth

## 2. 现有结构分析

* 已定义了 User 和 Task 模型，Task 与 User 是一对多关系

* API 入口已配置，使用 Hono.js 作为 API 框架

* 项目中已有 TanStack React Query 依赖，可用于数据获取和状态管理

* 前端页面目前使用 Mock 数据

## 3. 实现步骤

### 3.1 创建数据服务层

* 创建 `src/services/taskService.ts` 文件，封装所有与任务相关的 API 调用

* 实现任务的 CRUD 操作方法

* 使用 `ky` 库（项目已安装）进行 HTTP 请求

### 3.2 配置 TanStack React Query

* 确保在 `app/layout.tsx` 中已配置 QueryClientProvider

* 如未配置，添加 QueryClientProvider 包裹整个应用

### 3.3 修改首页数据获取

* 将首页从使用 Mock 数据改为使用 `useQuery` 从 API 获取真实数据

* 实现任务的创建、更新和删除功能

* 确保四象限视图和列表视图都使用真实数据

### 3.4 修改任务详情页

* 将任务详情页从使用 Mock 数据改为使用 `useQuery` 从 API 获取真实数据

* 实现任务状态更新功能

* 实现任务编辑功能

### 3.5 实现新建任务功能

* 将新建任务弹窗与 API 连接，实现真实任务创建

* 确保表单验证和错误处理

### 3.6 实现任务操作菜单功能

* 实现编辑、删除、复制等操作的 API 调用

* 确保操作成功后数据实时更新

### 3.7 数据缓存和状态管理

* 合理使用 TanStack React Query 的缓存机制

* 实现数据更新后缓存自动失效和重新获取

## 4. API 设计（如需调整）

确保后端 API 包含以下 endpoints：

* `GET /api/tasks` - 获取任务列表

* `GET /api/tasks/:id` - 获取任务详情

* `POST /api/tasks` - 创建新任务

* `PUT /api/tasks/:id` - 更新任务

* `DELETE /api/tasks/:id` - 删除任务

## 5. 实现细节

### 5.1 数据服务层示例

```typescript
// src/services/taskService.ts
import ky from 'ky'

const api = ky.extend({
  prefixUrl: '/api',
})

export const taskService = {
  async getTasks() {
    return api.get('tasks').json()
  },
  
  async getTask(id: string) {
    return api.get(`tasks/${id}`).json()
  },
  
  async createTask(data: any) {
    return api.post('tasks', { json: data }).json()
  },
  
  async updateTask(id: string, data: any) {
    return api.put(`tasks/${id}`, { json: data }).json()
  },
  
  async deleteTask(id: string) {
    return api.delete(`tasks/${id}`).json()
  }
}
```

### 5.2 页面数据获取示例

```typescript
// src/app/(main)/home/page.tsx
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { taskService } from '@/services/taskService'

// 获取任务列表
const { data: tasks = [], isLoading } = useQuery({
  queryKey: ['tasks'],
  queryFn: taskService.getTasks
})

// 创建任务
const queryClient = useQueryClient()
const createTaskMutation = useMutation({
  mutationFn: taskService.createTask,
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['tasks'] })
  }
})
```

## 6. 测试和验证

* 确保所有页面都能正确获取和显示数据

* 测试任务的创建、更新和删除功能

* 验证数据缓存和状态管理是否正常工作

* 确保错误处理和加载状态显示正确

## 7. 预期结果

* 所有页面都使用从数据库获取的真实数据

* 任务的创建、更新和删除功能正常工作

* 数据更新后页面实时刷新

* 良好的用户体验，包括加载状态和错误处理

## 8. 风险和注意
