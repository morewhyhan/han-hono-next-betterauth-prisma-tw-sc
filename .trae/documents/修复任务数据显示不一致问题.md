# 修复任务数据显示不一致问题

## 问题分析

经过仔细检查，我发现系统中存在任务数据显示不一致的问题：

1. **首页获取不到数据**：`todayTasks` 过滤逻辑使用了本地时间，但日期比较方式可能存在问题
2. **任务列表可以获取到数据**：没有日期过滤，直接显示所有任务
3. **日历视图数据不完全**：只显示有 `dueDate` 的任务，且日期分组逻辑可能存在问题

## 根本原因

1. **日期格式不一致**：不同组件对 `dueDate` 的解析和比较方式不同
2. **时区处理问题**：数据库中存储的 UTC 时间在前端解析时可能产生日期偏移
3. **数据过滤逻辑问题**：各组件使用不同的日期过滤逻辑

## 修复方案

### 1. 统一日期处理逻辑

**修改** **`useTasks`** **hook**：

* 确保返回的任务数据中 `dueDate` 格式一致

* 添加辅助函数，统一日期比较逻辑

**修改文件**：`/Users/zhaohuan/Desktop/FoogTask/hooks/tasks/useTasks.ts`

### 2. 修复首页日期过滤逻辑

**修改首页的** **`todayTasks`** **过滤**：

* 确保使用本地时间进行日期比较

* 修复可能的时区偏移问题

**修改文件**：`/Users/zhaohuan/Desktop/FoogTask/app/(main)/home/page.tsx`

### 3. 优化日历视图数据处理

**修改日历视图的任务分组**：

* 确保所有任务都能被正确分组

* 修复空 `dueDate` 任务的处理

**修改文件**：`/Users/zhaohuan/Desktop/FoogTask/components/calendar/CalendarView.tsx`

### 4. 确保 API 返回一致的日期格式

**修改 API 端点**：

* 确保返回的日期格式一致

* 统一使用 ISO 格式返回日期

**修改文件**：`/Users/zhaohuan/Desktop/FoogTask/server/api/routes/task.ts`

## 修复效果

1. **首页**：正确显示当天的任务
2. **任务列表**：显示所有任务
3. **日历视图**：显示所有有 `dueDate` 的任务，且分组正确
4. **数据一致性**：所有组件显示的数据保持一致

## 技术要点

* 使用本地时间进行日期比较

* 统一日期解析和格式化方式

* 确保 API

